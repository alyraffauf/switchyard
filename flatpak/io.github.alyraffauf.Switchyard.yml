app-id: io.github.alyraffauf.Switchyard
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: switchyard

finish-args:
  # Display
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri

  # Portal access for opening URLs in browsers
  - --talk-name=org.freedesktop.portal.Desktop

  # Read desktop files to detect installed browsers
  - --filesystem=~/.local/share/applications:ro
  - --filesystem=/usr/share/applications:ro
  - --filesystem=/var/lib/flatpak/exports/share/applications:ro
  - --filesystem=~/.local/share/flatpak/exports/share/applications:ro

  # Config storage
  - --filesystem=xdg-config/switchyard:create

modules:
  - name: switchyard
    buildsystem: simple
    build-options:
      env:
        GOROOT: /usr/lib/sdk/golang
        GOPATH: /run/build/switchyard/go
        CGO_ENABLED: "1"
    build-commands:
      - |
        . /usr/lib/sdk/golang/enable.sh
        go build -mod=vendor -trimpath -ldflags="-s -w" -o switchyard ./src
      - install -Dm755 switchyard /app/bin/switchyard
      - install -Dm644 data/io.github.alyraffauf.Switchyard.desktop /app/share/applications/io.github.alyraffauf.Switchyard.desktop
      - install -Dm644 data/io.github.alyraffauf.Switchyard.metainfo.xml /app/share/metainfo/io.github.alyraffauf.Switchyard.metainfo.xml
      - install -Dm644 data/icons/hicolor/scalable/apps/io.github.alyraffauf.Switchyard.svg /app/share/icons/hicolor/scalable/apps/io.github.alyraffauf.Switchyard.svg
    sources:
      - type: dir
        path: ..
